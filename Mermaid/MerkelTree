graph TD
    subgraph Local Machine
        A[1 New File Added/Modified] --> B[2 File System Watcher Daemon]
        B --> C[3 Calculate File Hash SHA-256]
        C --> D[4 Check Against Local File Registry]
        D --> E{5 File Changed?}
        E -->|Yes| F[6 Generate AES Encryption Key from Passphrase]
        E -->|No| Z[Skip Processing]
        F --> G[7 Encrypt File with AES-256]
        G --> H[8 Create File Metadata]
        H --> I[9 Update Local Registry]
        I --> J[10 Select Remote Targets Based on Replication Factor]
    end

    subgraph Remote Selection Logic
        J --> K[11 Check Remote Health Status]
        K --> L[12 Load Balance Across Available Remotes]
        L --> M[13 Generate Transfer Queue]
    end

    subgraph File Transfer Process
        M --> N[14 Establish Secure Connection SSH/SFTP]
        N --> O[15 Transfer Encrypted File]
        O --> P[16 Transfer Metadata JSON]
        P --> Q[17 Verify Transfer Integrity]
        Q --> R{18 Transfer Success?}
        R -->|No| S[19 Retry with Different Remote]
        R -->|Yes| T[20 Update Remote Registry]
        S --> N
    end

    subgraph Remote Machine Processing
        T --> U[21 Remote Daemon Receives File]
        U --> V[22 Validate File Integrity]
        V --> W[23 Store in Remote File Structure]
        W --> X[24 Update Remote Metadata Database]
        X --> Y[25 Send Acknowledgment to Source]
    end

    subgraph File Deletion Handling
        A1[File Deleted Locally] --> B1[File Watcher Detects Deletion]
        B1 --> C1[Send Delete Command to Remotes]
        C1 --> D1[Remote Moves File to Trash Folder]
        D1 --> E1[Schedule Permanent Deletion After N Days]
    end

    subgraph Remote-to-Remote Replication
        AA[Remote Machine Acts as Source] --> BB[Uses Same Daemon Logic]
        BB --> CC[Encrypts with Own Key]
        CC --> DD[Replicates to Other Remotes]
        DD --> EE[Maintains Separate Key Management]
    end

    style A fill:#FFB6C1,stroke:#333,stroke-width:2px
    style B fill:#98FB98,stroke:#333,stroke-width:2px
    style G fill:#FFD700,stroke:#333,stroke-width:2px
    style N fill:#87CEEB,stroke:#333,stroke-width:2px
    style U fill:#DDA0DD,stroke:#333,stroke-width:2px
    style A1 fill:#FFA07A,stroke:#333,stroke-width:2px